{"version":3,"sources":["../../../../src/components/VCalendar/modes/stack.ts"],"names":[],"mappings":"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","sourcesContent":["import { CalendarEventOverlapMode, CalendarEventVisual } from 'vuetify/types'\nimport { getOverlapGroupHandler, getVisuals, hasOverlap, getNormalizedRange } from './common'\nimport { getTimestampIdentifier } from '../util/timestamp'\n\ninterface Group {\n  start: number\n  end: number\n  visuals: CalendarEventVisual[]\n}\n\ninterface Node {\n  parent: Node | null\n  sibling: boolean\n  index: number\n  visual: CalendarEventVisual\n  start: number\n  end: number\n  children: Node[]\n}\n\nconst FULL_WIDTH = 100\n\nconst DEFAULT_OFFSET = 5\n\nconst WIDTH_MULTIPLIER = 1.7\n\n/**\n * Variation of column mode where events can be stacked. The priority of this\n * mode is to stack events together taking up the least amount of space while\n * trying to ensure the content of the event is always visible as well as its\n * start and end. A sibling column has intersecting event content and must be\n * placed beside each other. Non-sibling columns are offset by 5% from the\n * previous column. The width is scaled by 1.7 so the events overlap and\n * whitespace is reduced. If there is a hole in columns the event width is\n * scaled up so it intersects with the next column. The columns have equal\n * width in the space they are given. If the event doesn't have any to the\n * right of it that intersect with it's content it's right side is extended\n * to the right side.\n */\n\nexport const stack: CalendarEventOverlapMode = (events, firstWeekday, overlapThreshold) => {\n  const handler = getOverlapGroupHandler(firstWeekday)\n\n  // eslint-disable-next-line max-statements\n  return (day, dayEvents, timed, reset) => {\n    if (!timed) {\n      return handler.getVisuals(day, dayEvents, timed, reset)\n    }\n\n    const dayStart = getTimestampIdentifier(day)\n    const visuals = getVisuals(dayEvents, dayStart)\n    const groups = getGroups(visuals, dayStart)\n\n    for (const group of groups) {\n      const nodes: Node[] = []\n\n      for (const visual of group.visuals) {\n        const child = getNode(visual, dayStart)\n        const index = getNextIndex(child, nodes)\n\n        if (index === false) {\n          const parent = getParent(child, nodes)\n          if (parent) {\n            child.parent = parent\n            child.sibling = hasOverlap(child.start, child.end, parent.start, addTime(parent.start, overlapThreshold))\n            child.index = parent.index + 1\n            parent.children.push(child)\n          }\n        } else {\n          const [parent] = getOverlappingRange(child, nodes, index - 1, index - 1)\n          const children = getOverlappingRange(child, nodes, index + 1, index + nodes.length, true)\n\n          child.children = children\n          child.index = index\n\n          if (parent) {\n            child.parent = parent\n            child.sibling = hasOverlap(child.start, child.end, parent.start, addTime(parent.start, overlapThreshold))\n            parent.children.push(child)\n          }\n\n          for (const grand of children) {\n            if (grand.parent === parent) {\n              grand.parent = child\n            }\n\n            const grandNext = grand.index - child.index <= 1\n            if (grandNext && child.sibling &&\n              hasOverlap(child.start, addTime(child.start, overlapThreshold), grand.start, grand.end)) {\n              grand.sibling = true\n            }\n          }\n        }\n\n        nodes.push(child)\n      }\n\n      calculateBounds(nodes, overlapThreshold)\n    }\n\n    visuals.sort((a, b) => (a.left - b.left) || (a.event.startTimestampIdentifier - b.event.startTimestampIdentifier))\n\n    return visuals\n  }\n}\n\nfunction calculateBounds (nodes: Node[], overlapThreshold: number) {\n  for (const node of nodes) {\n    const { visual, parent } = node\n    const columns = getMaxChildIndex(node) + 1\n    const spaceLeft = parent ? parent.visual.left : 0\n    const spaceWidth = FULL_WIDTH - spaceLeft\n    const offset = Math.min(DEFAULT_OFFSET, FULL_WIDTH / columns)\n    const columnWidthMultiplier = getColumnWidthMultiplier(node, nodes)\n    const columnOffset = spaceWidth / (columns - node.index + 1)\n    const columnWidth = spaceWidth / (columns - node.index + (node.sibling ? 1 : 0)) * columnWidthMultiplier\n\n    if (parent) {\n      visual.left = node.sibling\n        ? spaceLeft + columnOffset\n        : spaceLeft + offset\n    }\n\n    visual.width = hasFullWidth(node, nodes, overlapThreshold)\n      ? FULL_WIDTH - visual.left\n      : Math.min(FULL_WIDTH - visual.left, columnWidth * WIDTH_MULTIPLIER)\n  }\n}\n\nfunction getColumnWidthMultiplier (node: Node, nodes: Node[]): number {\n  if (!node.children.length) {\n    return 1\n  }\n\n  const maxColumn = node.index + nodes.length\n  const minColumn = node.children.reduce((min, c) => Math.min(min, c.index), maxColumn)\n\n  return minColumn - node.index\n}\n\nfunction getOverlappingIndices (node: Node, nodes: Node[]): number[] {\n  const indices: number[] = []\n  for (const other of nodes) {\n    if (hasOverlap(node.start, node.end, other.start, other.end)) {\n      indices.push(other.index)\n    }\n  }\n  return indices\n}\n\nfunction getNextIndex (node: Node, nodes: Node[]): number | false {\n  const indices = getOverlappingIndices(node, nodes)\n  indices.sort()\n\n  for (let i = 0; i < indices.length; i++) {\n    if (i < indices[i]) {\n      return i\n    }\n  }\n  return false\n}\n\nfunction getOverlappingRange (node: Node, nodes: Node[], indexMin: number, indexMax: number, returnFirstColumn = false): Node[] {\n  const overlapping: Node[] = []\n  for (const other of nodes) {\n    if (other.index >= indexMin && other.index <= indexMax && hasOverlap(node.start, node.end, other.start, other.end)) {\n      overlapping.push(other)\n    }\n  }\n  if (returnFirstColumn && overlapping.length > 0) {\n    const first = overlapping.reduce((min, n) => Math.min(min, n.index), overlapping[0].index)\n    return overlapping.filter(n => n.index === first)\n  }\n  return overlapping\n}\n\nfunction getParent (node: Node, nodes: Node[]): Node | null {\n  let parent: Node | null = null\n  for (const other of nodes) {\n    if (hasOverlap(node.start, node.end, other.start, other.end) && (parent === null || other.index > parent.index)) {\n      parent = other\n    }\n  }\n  return parent\n}\n\nfunction hasFullWidth (node: Node, nodes: Node[], overlapThreshold: number): boolean {\n  for (const other of nodes) {\n    if (other !== node &&\n      other.index > node.index &&\n      hasOverlap(node.start, addTime(node.start, overlapThreshold), other.start, other.end)) {\n      return false\n    }\n  }\n\n  return true\n}\n\nfunction getGroups (visuals: CalendarEventVisual[], dayStart: number): Group[] {\n  const groups: Group[] = []\n\n  for (const visual of visuals) {\n    const [start, end] = getNormalizedRange(visual.event, dayStart)\n    let added = false\n\n    for (const group of groups) {\n      if (hasOverlap(start, end, group.start, group.end)) {\n        group.visuals.push(visual)\n        group.end = Math.max(group.end, end)\n        added = true\n        break\n      }\n    }\n\n    if (!added) {\n      groups.push({ start, end, visuals: [visual] })\n    }\n  }\n\n  return groups\n}\n\nfunction getNode (visual: CalendarEventVisual, dayStart: number): Node {\n  const [start, end] = getNormalizedRange(visual.event, dayStart)\n\n  return {\n    parent: null,\n    sibling: true,\n    index: 0,\n    visual,\n    start,\n    end,\n    children: [],\n  }\n}\n\nfunction getMaxChildIndex (node: Node): number {\n  let max = node.index\n  for (const child of node.children) {\n    const childMax = getMaxChildIndex(child)\n    if (childMax > max) {\n      max = childMax\n    }\n  }\n  return max\n}\n\nfunction addTime (identifier: number, minutes: number): number {\n  const removeMinutes = identifier % 100\n  const totalMinutes = removeMinutes + minutes\n  const addHours = Math.floor(totalMinutes / 60)\n  const addMinutes = totalMinutes % 60\n\n  return identifier - removeMinutes + addHours * 100 + addMinutes\n}\n"],"sourceRoot":"","file":"stack.js"}